<!DOCTYPE html>
<html lang="en">
<head>
  <title>PCI GUI</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="add/bootstrap.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="add/jquery.min.js"></script>
  <script src="add/bootstrap.min.js"></script>
  <script src="add/canvasjs.min.js"></script>

  <script src="default.js"></script>
  <script src="WaveDrom.js"></script>
</head>
<body>
  <form>
  <div class="radio" id="dev1">
        <label><input type="radio"  name="optradio" id="dev1Initiator">Initiator</label>
          <label><input type="radio" name="optradio" id="dev1Target">Target</label>
  </div>
</form>
<form>
  <div class="radio" id="dev2">
        <label><input type="radio" name="optradio" id="dev2Initiator">Initiator</label>
          <label><input type="radio" name="optradio" id="dev2Target">Target</label>
  </div>
</form>
<form>
  <div class="radio" id="dev3">
        <label><input type="radio" name="optradio" id="dev3Initiator">Initiator</label>
          <label><input type="radio" name="optradio" id="dev3Target">Target</label>
  </div>
</form>
  <svg width="500" height="280">
    <g>
    <rect x="250" y="20" rx="20" ry="20" width="250" height="250" style="fill:red;stroke:black;stroke-width:5;opacity:0.8" />
    <text x="320" y="50" font-family="Verdana" font-size="25" fill="gray">Device A</text>
    <text x="330" y="80" font-family="Verdana" font-size="20" fill="black" id="d1-w1">xxxxxxxx</text>
    <text x="330" y="100" font-family="Verdana" font-size="20" fill="black" id="d1-w2">xxxxxxxx</text>
    <text x="330" y="120" font-family="Verdana" font-size="20" fill="black" id="d1-w3">xxxxxxxx</text>
    <text x="330" y="140" font-family="Verdana" font-size="20" fill="black" id="d1-w4">xxxxxxxx</text>
    <text x="330" y="160" font-family="Verdana" font-size="20" fill="black" id="d1-w5">xxxxxxxx</text>
    <text x="330" y="180" font-family="Verdana" font-size="20" fill="black" id="d1-w6">xxxxxxxx</text>
    <text x="330" y="200" font-family="Verdana" font-size="20" fill="black" id="d1-w7">xxxxxxxx</text>
    <text x="330" y="220" font-family="Verdana" font-size="20" fill="black" id="d1-w8">xxxxxxxx</text>
    <text x="330" y="240" font-family="Verdana" font-size="20" fill="black" id="d1-w9">xxxxxxxx</text>
    <text x="330" y="260" font-family="Verdana" font-size="20" fill="black" id="d1-w10">xxxxxxxx</text>
</g>

  </svg>
  <svg width="500" height="280">
    <g>
    <rect x="250" y="20" rx="20" ry="20" width="250" height="250" style="fill:red;stroke:black;stroke-width:5;opacity:0.8" />
    <text x="320" y="50" font-family="Verdana" font-size="25" fill="gray">Device B</text>
    <text x="330" y="80" font-family="Verdana" font-size="20" fill="black" id="d2-w1">xxxxxxxx</text>
    <text x="330" y="100" font-family="Verdana" font-size="20" fill="black" id="d2-w2">xxxxxxxx</text>
    <text x="330" y="120" font-family="Verdana" font-size="20" fill="black" id="d2-w3">xxxxxxxx</text>
    <text x="330" y="140" font-family="Verdana" font-size="20" fill="black" id="d2-w4">xxxxxxxx</text>
    <text x="330" y="160" font-family="Verdana" font-size="20" fill="black" id="d2-w5">xxxxxxxx</text>
    <text x="330" y="180" font-family="Verdana" font-size="20" fill="black" id="d2-w6">xxxxxxxx</text>
    <text x="330" y="200" font-family="Verdana" font-size="20" fill="black" id="d2-w7">xxxxxxxx</text>
    <text x="330" y="220" font-family="Verdana" font-size="20" fill="black" id="d2-w8">xxxxxxxx</text>
    <text x="330" y="240" font-family="Verdana" font-size="20" fill="black" id="d2-w9">xxxxxxxx</text>
    <text x="330" y="260" font-family="Verdana" font-size="20" fill="black" id="d2-w10">xxxxxxxx</text>
</g>
</svg>
<div class="vl"></div>
<div class="v2"></div>
<div class="v3"></div>
<div class="v4"></div>
  <div class="container">
<br>
    <div class="progress">
      <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">

      </div>
    </div>
  </div>

  <svg width="500" height="280">
    <g>
    <rect x="250" y="20" rx="20" ry="20" width="250" height="250" style="fill:red;stroke:black;stroke-width:5;opacity:0.8" />
    <text x="320" y="50" font-family="Verdana" font-size="25" fill="gray">Device C</text>
    <text x="330" y="80" font-family="Verdana" font-size="20" fill="black" id="d3-w1">xxxxxxxx</text>
    <text x="330" y="100" font-family="Verdana" font-size="20" fill="black" id="d3-w2">xxxxxxxx</text>
    <text x="330" y="120" font-family="Verdana" font-size="20" fill="black" id="d3-w3">xxxxxxxx</text>
    <text x="330" y="140" font-family="Verdana" font-size="20" fill="black" id="d3-w4">xxxxxxxx</text>
    <text x="330" y="160" font-family="Verdana" font-size="20" fill="black" id="d3-w5">xxxxxxxx</text>
    <text x="330" y="180" font-family="Verdana" font-size="20" fill="black" id="d3-w6">xxxxxxxx</text>
    <text x="330" y="200" font-family="Verdana" font-size="20" fill="black" id="d3-w7">xxxxxxxx</text>
    <text x="330" y="220" font-family="Verdana" font-size="20" fill="black" id="d3-w8">xxxxxxxx</text>
    <text x="330" y="240" font-family="Verdana" font-size="20" fill="black" id="d3-w9">xxxxxxxx</text>
    <text x="330" y="260" font-family="Verdana" font-size="20" fill="black" id="d3-w10">xxxxxxxx</text>
</g>
</svg>
<svg width="500" height="280">
  <g>
  <rect x="50" y="20" rx="20" ry="20" width="150" height="150" style="fill:red;stroke:black;stroke-width:5;opacity:0.8" />
  <text x="80" y="80" font-family="Verdana" font-size="25" fill="gray">Arbiter</text>
</g>
</svg>
<br>
<g>
  <text id="numberofphasestext" font-family="Verdana" fill="gray">Number of Dataphases</text>
 <input type="text" id="numberofphases" name="numberofphases" >
 <input id="start" type="button"  value="Start">
 <form>
 <div class="radio" id="transactiontype">
       <label><input type="radio" name="optradio" id="transactiontypeWrite">Write</label>
       <label><input type="radio" name="optradio" id="transactiontypeRead">Read</label>
 </div>
</form>
</g>

<script id="wvscript" type="WaveDrom">


</script>


<script>
function generateclockDataPoints(size,max,min,onephase_inc,read,write) {
    var i,onephase=0,arr = [],toggle=1;
    if(size==3)
    onephase=2;
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
if(toggle==1)
        arr.push(
            max
        );
else if(toggle==-1)
        arr.push(
            min
        );
        toggle=-toggle;
    }

    return arr;
}

function generatereqDataPoints(index,m1,m2,m3,size,onephase_inc,read,write) {
    var i,onephase=0,arr = [];
    if(size==3)
    onephase=2;
  if((index==1)&&(m1==1))
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<1)||(i>(size+onephase-1)))
        arr.push(
           1
        );
      else if(i>=1)
        arr.push(
            0
        );
    }
    else if((index==1)&&(m1==0))
    {
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++)
    {
    arr.push(
        1
    );
    }
    }
else   if((index==2)&&(m2==1))
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
    if((i<1)||(i>(size+onephase-1)))
        arr.push(
            1
        );
      else if(i>=1)
        arr.push(
            0
        );
    }
else if((index==2)&&(m2==0))
{
for (i = 0; i < 2*size+3+onephase_inc-2*write; i++)
{
arr.push(
    1
);
}
}
else   if((index==3)&&(m3==1))
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<1)||(i>(size+onephase-1)))
        arr.push(
            1
        );
      else if(i>=1)
        arr.push(
            0
        );
    }
    else if((index==3)&&(m3==0))
    {
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++)
    {
    arr.push(
        1
    );
    }
    }





    return arr;


}

function generategntDataPoints(index,m1,m2,m3,size,onephase_inc,read,write) {
    var i,onephase=0,arr = [];

    if(size==3)
    onephase=2;
    if((index==1)&&(m1==1))
      for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
        if((i<3)||(i>(size+onephase+1)))
          arr.push(
             1
          );
        else if(i>=3)
          arr.push(
              1
          );
      }
      else if((index==1)&&(m1==0))
      {
      for (i = 0; i < 2*size+3+onephase_inc-2*write; i++)
      {
      arr.push(
          1
      );
      }
      }
  else   if((index==2)&&(m2==1))
      for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
        if((i<3)||(i>(size+onephase+1)))
          arr.push(
              1
          );
        else if(i>=3)
          arr.push(
              0
          );
      }
  else if((index==2)&&(m2==0))
  {
  for (i = 0; i < 2*size+3+onephase_inc-2*write; i++)
  {
  arr.push(
      1
  );
  }
  }
  else   if((index==3)&&(m3==1))
      for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
  if((i<3)||(i>(size+onephase+1)))
          arr.push(
             1
          );
        else if(i>=3)
          arr.push(
              0
          );
      }
      else if((index==3)&&(m3==0))
      {
      for (i = 0; i < 2*size+3+onephase_inc-2*write; i++)
      {
      arr.push(
          1
      );
      }
      }


    return arr;


}

function generateadDataPoints(numberofphases)
{
	
	var arr = [],i;
	arr.push("z.");
	arr.push("=.");
	
	for(i=0; i <numberofphases;i++)
	{arr.push("=..");}
	arr.push("z");
	
	return arr;
}


function generateframeDataPoints(size,read,write,onephase_inc) {
    var i,onephase=0,
        arr = [];
        if(size==3)
        onephase=2;
        if(write==1)
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<=4)||(i>(size+1+onephase)))
        arr.push(
            1
        );
        else if((i>=5)&&(i<=(size+1+onephase)))
        {arr.push(
            0
        );
          }

    }
    else if(read==1)
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<=4)||(i>(size+3+onephase)))
        arr.push(
            1
        );
        else if((i>=5)&&(i<=(size+3+onephase)))
        {arr.push(
            0
        );
          }

    }

    return arr;
}

function generatetrdyDataPoints(size,read,write,onephase_inc) {
    var i,onephase=0,
        arr = [];
if(size==3)
onephase=2;
  if(write==1)
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<=6)||(i>(size+3+onephase)))
        arr.push(
           1
        );
        else if((i>=7)&&(i<=(size+3+onephase)))
        {arr.push(
            0
        );
          }
    }
else if (read==1) {
  for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
    if((i<=8)||(i>(size+5+onephase)))
      arr.push(
          1
      );
      else if((i>=9)&&(i<=(size+5+onephase)))
      {arr.push(
          0
      );
        }
  }
}




    return arr;
}

function generateirdyDataPoints(size,read,write,onephase_inc) {
    var i,onephase=0,
        arr = [];
if(size==3)
onephase=2;
      if(write==1)
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<=6)||(i>(size+3+onephase)))
        arr.push(
            1
        );
        else if((i>=7)&&(i<=(size+3+onephase)))
        {arr.push(
            0
        );
          }

    }
    else if(read==1)
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<=6)||(i>(size+5+onephase)))
        arr.push(
            1
        );
        else if((i>=7)&&(i<=(size+5+onephase)))
        {arr.push(
            0
        );
          }

    }
    return arr;
}

function generatedevselDataPoints(size,read,write,onephase_inc) {
    var i,onephase=0,
        arr = [];
if(size==3)
onephase=2;
  if(write==1)
    for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
      if((i<=6)||(i>(size+3+onephase)))
        arr.push(
            1
        );
        else if((i>=7)&&(i<=(size+3+onephase)))
        {arr.push(
            0
        );
          }
    }
else if (read==1) {
  for (i = 0; i < 2*size+3+onephase_inc-2*write; i++) {
    if((i<=8)||(i>(size+5+onephase)))
      arr.push(
          1
      );
      else if((i>=9)&&(i<=(size+5+onephase)))
      {arr.push(
          0
      );
        }
  }
}




    return arr;
}


function load(clockDataPoints,REQADataPoints,REQBDataPoints,REQCDataPoints,GNTADataPoints,GNTBDataPoints,GNTCDataPoints,FRAMEDataPoints,IRDYDataPoints,TRDYDataPoints,DEVSELDataPoints,signal_AD_labels,ADDataPoints)
{
data = { signal : [
  { name: "CLOCK",  wave: clockDataPoints },
  { name: "REQA ",  wave: REQADataPoints},
  { name: "REQB", wave: REQBDataPoints },
  { name: " REQC ", wave: REQCDataPoints },
  { name: "GNTA", wave: GNTADataPoints },
  { name: "GNTB", wave: GNTBDataPoints },
  { name: "GNTC", wave: GNTCDataPoints  },
  { name: "FRAME", wave: FRAMEDataPoints },
  { name: "A_D", wave: ADDataPoints ,data: signal_AD_labels},
  { name: "C_BE", wave: DEVSELDataPoints},
  { name: "IRDY", wave: IRDYDataPoints },
  { name: "TRDY", wave:  TRDYDataPoints},
  { name: "DEVSEL  ", wave: DEVSELDataPoints },
   
]};


document.querySelector('script[type="WaveDrom"]').innerHTML = JSON.stringify(data,null,2);


}

$(document).ready(function(){
//  function generateDataPoints(size);


    $("#dev1Target").click(function(){
      if(    ($('#dev2Target').is(':checked'))  ||  ($('#dev3Target').is(':checked'))   )
    {
      alert("Only One Target");
     document.getElementById("dev1Target").checked = false;
     document.getElementById("dev2Target").checked = false;
     document.getElementById("dev3Target").checked = false;
   }

     });
   $("#dev2Target").click(function(){
     if(    ($('#dev1Target').is(':checked'))  ||  ($('#dev3Target').is(':checked'))   )
   {
     alert("Only One Target");
    document.getElementById("dev1Target").checked = false;
    document.getElementById("dev2Target").checked = false;
    document.getElementById("dev3Target").checked = false;
  }

    });

  $("#dev3Target").click(function(){
    if(    ($('#dev1Target').is(':checked'))  ||  ($('#dev2Target').is(':checked'))   )
  {
    alert("Only One Target");
   document.getElementById("dev1Target").checked = false;
   document.getElementById("dev2Target").checked = false;
   document.getElementById("dev3Target").checked = false;
 }


});

 $("#dev1Initiator").click(function(){
   if(    ($('#dev2Initiator').is(':checked'))  &&  ($('#dev3Initiator').is(':checked'))   )
 {
   alert("Max two Initiators");
  document.getElementById("dev1Initiator").checked = false;
  document.getElementById("dev2Initiator").checked = false;
  document.getElementById("dev3Initiator").checked = false;
}

  });
  $("#dev2Initiator").click(function(){
    if(    ($('#dev1Initiator').is(':checked'))  &&  ($('#dev3Initiator').is(':checked'))   )
  {
    alert("Max two Initiators");
   document.getElementById("dev1Initiator").checked = false;
   document.getElementById("dev2Initiator").checked = false;
   document.getElementById("dev3Initiator").checked = false;
 }

   });
   $("#dev3Initiator").click(function(){
     if(    ($('#dev1Initiator').is(':checked'))  &&  ($('#dev2Initiator').is(':checked'))   )
   {
     alert("Max two Initiators");
    document.getElementById("dev1Initiator").checked = false;
    document.getElementById("dev2Initiator").checked = false;
    document.getElementById("dev3Initiator").checked = false;
  }

    });







/*

     var count=0;
     function generateDataPoints(size) {
         var i,
             arr = [],
         for (i = 0; i < 10; i++) {
             arr.push({
                 y:0;
                 y:1;
             });
         }
         return arr;
     }
     var clockDataPoints = generateDataPoints(20);



*/






var clockDataPoints=[];
var REQADataPoints=[];
var REQBDataPoints=[];
var REQCDataPoints=[];
var GNTADataPoints=[];
var GNTBDataPoints=[];
var GNTCDataPoints=[];
var FRAMEDataPoints=[];
var IRDYDataPoints=[];
var TRDYDataPoints=[];
var DEVSELDataPoints=[];
var ADDataPoints = [];
var size=0;
var lastplace=[0,0,0];
var i;
var j;
var onephase_inc=0;




$("#start").click(function () {
var target1,target2,target3,master1,master2,master3,master1_gnt,master2_gnt,master3_gnt,read,write;
var numberofphases=$("#numberofphases").val();
if(    ($('#dev1Target').is(':checked')) )
target1=1;
else
target1=0;
if(    ($('#dev2Target').is(':checked')) )
target2=1;
else
target2=0;
if(    ($('#dev3Target').is(':checked')) )
target3=1;
else
target3=0;
if(    ($('#dev1Initiator').is(':checked')) )
master1=1;
else
master1=0;
if(    ($('#dev2Initiator').is(':checked')) )
master2=1;
else
master2=0;
if(    ($('#dev3Initiator').is(':checked')) )
master3=1;
else
master3=0;
if(    ($('#transactiontypeWrite').is(':checked')) )
write=1;
else
write=0;
if(    ($('#transactiontypeRead').is(':checked')) )
read=1;
else
read=0;
/////Parity
master1_gnt=master1;
master2_gnt=master2;
master3_gnt=master3;
if(master1_gnt==1)
{
  master2_gnt=0;
  master3_gnt=0;
}
else if(master2_gnt==1)
  master3_gnt=0;

//////////////////////////////////
var c=0,e=0;
var t,m;
var word_read,word_write;
if(master1==1)
{
  word_write="AAAAAAAA";
  m=1;
}
else if(master2==1)
{
word_write="BBBBBBBB";
 m=2;
}
else if(master3==1)
{
word_write="CCCCCCCC";
m=3;
}
if(target1==1)
{
t=1;
word_read="AAAAAAAA";
}
else if(target2==1)
{
t=2;
word_read="BBBBBBBB";
}
else if(target3==1)
{
t=3;
word_read="CCCCCCCC";
}
if(write==1)
{
for(c=1;c<=numberofphases;c++)
{
  i=lastplace[t-1]+c;
document.getElementById("d"+t+"-w"+i).innerHTML = word_write;
document.getElementById("d"+t+"-w"+i).style.fontSize = "large";
//if(c==numberofphases)
if(i>=10)
break;
}
for(c=1;c<=numberofphases;c++)
lastplace[t-1]++;
}
if(lastplace[t-1]>=10)
lastplace[t-1]=0;


if(read==1)
{
for(e=1;e<=numberofphases;e++)
{
  j=lastplace[m-1]+e;
document.getElementById("d"+m+"-w"+j).innerHTML = word_read;
document.getElementById("d"+m+"-w"+j).style.fontSize = "large";
if(j>=10)
break;
}
for(e=1;e<=numberofphases;e++)
lastplace[m-1]++;
}

if(lastplace[m-1]>=10)
lastplace[m-1]=0;


  alert("Value: " + numberofphases + "target1: " + target1 + "target2: " + target2 + "target3: " + target3 + "master1: " + master1 + "master2: " + master2 + "master3: " + master3 + "read: " + read + "write: " + write);
  var count=0;

if(numberofphases==1)
onephase_inc=4;
else {
  onephase_inc=0;
}
size=numberofphases*3;
 //size+=numberofphases*3;
//var sizewidth=numberofphases*1080;
var arr1= generateclockDataPoints(size,1,0,onephase_inc,read,write);
var arr2= generatereqDataPoints(1,master1,master2,master3,size,onephase_inc,read,write);
var arr3= generatereqDataPoints(2,master1,master2,master3,size,onephase_inc,read,write);
var arr4= generatereqDataPoints(3,master1,master2,master3,size,onephase_inc,read,write);
var arr5= generategntDataPoints(1,master1_gnt,master2_gnt,master3_gnt,size,onephase_inc,read,write);
var arr6= generategntDataPoints(2,master1_gnt,master2_gnt,master3_gnt,size,onephase_inc,read,write);
var arr7= generategntDataPoints(3,master1_gnt,master2_gnt,master3_gnt,size,onephase_inc,read,write);
var arr8= generateframeDataPoints(size,read,write,onephase_inc);
var arr9= generateirdyDataPoints(size,read,write,onephase_inc);
var arr10= generatetrdyDataPoints(size,read,write,onephase_inc);
var arr11= generatedevselDataPoints(size,read,write,onephase_inc);
var arr12 = generateadDataPoints(numberofphases);

//arrayA=arrayA.concat(arrayB);
  clockDataPoints =smooth(clockDataPoints.concat(arr1) ).join("");
  REQADataPoints =smooth(REQADataPoints.concat(arr2)).join("");
  REQBDataPoints =smooth(REQBDataPoints.concat(arr3)).join("");
  REQCDataPoints =smooth(REQCDataPoints.concat(arr4)).join("");
  GNTADataPoints =smooth(GNTADataPoints.concat(arr5)).join("");
  GNTBDataPoints =smooth(GNTBDataPoints.concat(arr6)).join("");
  GNTCDataPoints =smooth(GNTCDataPoints.concat(arr7)).join("");
  FRAMEDataPoints =smooth(FRAMEDataPoints.concat(arr8)).join("");
  IRDYDataPoints =smooth(IRDYDataPoints.concat(arr9)).join("");
  TRDYDataPoints =smooth(TRDYDataPoints.concat(arr10)).join("");
  DEVSELDataPoints =smooth(DEVSELDataPoints.concat(arr11)).join("");
  ADDataPoints = ADDataPoints.concat(arr12).join("");
  alert(ADDataPoints);
  
  var signal_AD_labels ;
 // console.log(ADDataPoints); 
 if(read==1)
 {  signal_AD_labels = word_write + " " ;}
else
{signal_AD_labels = word_read + " ";}

  var signal_AD_prefix =  word_write + " ";
  
  signal_AD_labels = signal_AD_prefix + signal_AD_labels.repeat(numberofphases);
  
load(clockDataPoints,REQADataPoints,REQBDataPoints,REQCDataPoints,GNTADataPoints,GNTBDataPoints,GNTCDataPoints,FRAMEDataPoints,IRDYDataPoints,TRDYDataPoints,DEVSELDataPoints ,signal_AD_labels,ADDataPoints);
WaveDrom.ProcessAll();




});
    });

	
function smooth(arr)
{
var i;

for (i =arr.length-1; i > 0 ; i--) { 
  if(arr[i] == arr[i-1]) 
  {arr[i] = '.';}
}

return arr;
}	
	
</script>
</body>
</html>
